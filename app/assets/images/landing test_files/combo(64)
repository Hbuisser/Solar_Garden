YUI.add("photo-charm-exif-scrappy-view",function(e,t){var i=require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.nsid=e.nsid,this.isMobileExif=e.isMobileExif||!1,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var t=this,o=[];return o.push(t.appContext.getModel("person-relationship-models",t.nsid).then(function(e){t.set("ownerRelationship",e)})),this.appContext.getViewer().signedIn&&o.push(t.appContext.getModel("person-models",t.appContext.getViewer().nsid).then(function(e){t.set("person",e)})),o.push(new e.FlickrPromise({location:t.appContext.getModel("photo-location-models",t.photoId),photo:t.appContext.getModel("photo-models",t.photoId),relationship:t.appContext.getModel("person-relationship-models",t.nsid),stats:t.appContext.getModel("photo-stats-models",t.photoId)}).then(function(e){t.set("location",e.location),t.set("photo",e.photo),t.set("relationship",e.relationship),t.set("stats",e.stats)})),o.push(t.appContext.getModel("photo-exif-models",t.photoId).then(function(i){var o=i.toJSON();t.set("exif",i),t.set("extendedExif",t.getExtendedExif()),t.set("cameraData",e.ExifCameraMap.getCameraImageURL(o.camera,o.cameraType,t.appContext))},function(e){i.warn("Exif failed to load for this photo",{err:e})})),e.Promise.all(o)},buildContainer:function(){var t,i,o,a=this.get("photo"),n=!!this.get("relationship")&&this.get("relationship").getValue("isMe"),s=this.get("exif")?this.get("exif").toJSON():null,l=!1,r=!1,h=this.get("location")?this.get("location").getValue("mostSpecificWoeId"):null,p=!1,d="",c=!1,g="",u="",f=this.get("stats");return void 0!==this.getViewDataFromHistory("showExpanded")&&!0===this.getViewDataFromHistory("showExpanded")&&(c=!0),s&&(s.metering||s.exposureProgram||s.flash||s.iso||s.exposureTime||s.focalLength||s.fNumber)&&(l=!0),this.get("location")&&(this.get("location").getValue("levels").venue?(r="foursquare"===this.get("location").getValue("levels").venue.source,i=this.get("location").getValue("levels").venue.venueId,o=e.url("/map/?fLat="+this.get("location").getValue("levels").venue.venueLat+"&fLon="+this.get("location").getValue("levels").venue.venueLong+"&zl=13&everyone_nearby=1")):this.get("location").getValue("latitude")&&(o=e.url("/map/?fLat="+this.get("location").getValue("latitude")+"&fLon="+this.get("location").getValue("longitude")+"&zl=13&everyone_nearby=1")),this.get("location").getValue("text")&&(g=this.get("location").getValue("text").replace(/<\/?[^>]+>/g,""))),n&&!this.isMobileExif&&(p=!0),this.get("cameraData")&&(d=this.get("cameraData").url),s&&(this.isMobileExif?u=s.flashFired||"Fired"===s.flash?this.intlMessage({intlName:"photo-page-scrappy.FLASH_SIMPLE_ON"}):this.intlMessage({intlName:"photo-page-scrappy.FLASH_SIMPLE_OFF"}):(s.flashModeAuto&&(u=s.flashFired?this.intlMessage({intlName:"photo-page-scrappy.FLASH_AUTO_FIRED"}):this.intlMessage({intlName:"photo-page-scrappy.FLASH_AUTO_NO_FIRE"})),s.flashModeOn&&(u=s.flashFired?this.intlMessage({intlName:"photo-page-scrappy.FLASH_ON_FIRED"}):this.intlMessage({intlName:"photo-page-scrappy.FLASH_ON_NO_FIRE"})),s.flashModeOff&&(u=this.intlMessage({intlName:"photo-page-scrappy.FLASH_OFF"})),"Fired"===s.flash&&(u=this.intlMessage({intlName:"photo-page-scrappy.FLASH_ON_FIRED"})))),t={exif:s,cameraData:d,location:this.get("location")?this.get("location").toJSON():{},locationText:g,isFoursquare:r,fourSquarePlaceId:i,isOwner:n,isVideo:!!a&&a.getValue("isVideo"),exifInfoIsPresent:l,mostSpecificWoeId:h,stats:this.get("stats")?this.get("stats").toJSON():{},showEditLocation:p,linkToMap:o,showExpanded:c,extendedExif:this.get("extendedExif"),flashString:u,isMobileExif:this.isMobileExif,dateTaken:f.getDateObj("dateTaken"),datePosted:f.getDateObj("datePosted"),takenGranularity:f.getValue("takenGranularity"),isDateTakenUnknown:f.getValue("isDateTakenUnknown")},this.setContainerWithTemplate("photo-charm-exif-scrappy",t),this},activate:function(){var t=this,i=this.get("stats"),o=this.get("container");return i&&this.registerEventHandler(i.on("valuesChanged",function(e){(e.dateTaken||e.datePosted||e.isCirca||e.isSometime||e.takenGranularity)&&t.buildContainer()})),this.registerEventHandler(this.get("container").on("click",this.handleContainerClick.bind(this))),0===o.one(".exif-column-1").get("children").size()&&0===o.one(".exif-column-2").get("children").size()&&(o.setStyle("display","none"),e.one(".sub-photo-right-row1").setStyle("borderBottom","none")),this.isMobileExif&&this.registerEventHandler(this.get("container").delegate("click",function(i){if(i.target){var o=i.target.getAttribute("data-woe-id");o&&(i.halt(),e.use("mobile-actions-helper",function(e){e.MobileActionsHelper.redirectToAppOrStore({os:t.appContext.getUA().os,isWebview:t.appContext.getUA().isWebview,pageURL:"/search/?woe_id="+o,beacon:{name:"mpp_location_click",section:"exif-view"},viewName:t.name})}))}},".location-name-link")),this},getExtendedExif:function(){var t=this.get("exif")?this.get("exif").toJSON():{},i=[];return e.clone(t.data).forEach(function(e){if(null!==e.value){if("Resolution Unit"===e.label||"Aperture"===e.label||"Exposure"===e.label||"Lens"===e.label||"Camera URL"===e.label||"Focal Length"===e.label||"ISOSetting"===e.label||"Flash"===e.label||"Exposure Program"===e.label||"Model"===e.label)return;"X-Resolution"!==e.label&&"Y-Resolution"!==e.label||(e.value=e.value+" dpi"),"Exposure Bias"===e.label&&(e.value=e.value+" EV"),i.push({label:e.label,value:e.value})}}),i},showMoreExif:function(){var e=this.get("container");e.one(".show-extended-exif").setHTML(this.intlMessage({intlName:"photo-page-scrappy.HIDE_EXIF"})),e.one(".show-extended-exif").addClass("hide-moreExif"),e.all(".extended-exif-item").show(),this.setViewDataOnHistory("showExpanded",!0)},hideMoreExif:function(){var e=this.get("container");e.one(".show-extended-exif").setHTML(this.intlMessage({intlName:"photo-page-scrappy.SHOW_EXIF"})),e.one(".show-extended-exif").removeClass("hide-moreExif"),e.all(".extended-exif-item").hide(),this.setViewDataOnHistory("showExpanded",!1)},handleLocationClick:function(){if(this.appContext.flipper.isFlipped("geotag-on-photo-page"))e.use(["fluid-modal-view","photo-geotag-modal-view"],function(){var t=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!0,showCancelButton:!0,showCancelX:!1,title:"",actionButtonLabel:this.intlMessage({intlName:"photo-page-scrappy.SAVE_LOCATION"}),width:640,height:340,fullWindow:!0,subview:new e.Views["photo-geotag-modal-view"]({appContext:this.appContext,photoId:this.get("photo").getValue("id"),locationId:this.get("location").getValue("id")})}),i=this,o=i.get("container").one(".map-container")||i.get("container").one(".empty-map");t.show(),this.registerEventHandler(t.on("actionClick",function(e){var t=this.templates("flickr-balls")({});o.append(t),i.appContext.getModelRegistry("photo-location-models").then(function(e){return e.remove(i.photoId),i.appContext.getModel("photo-location-models",i.photoId)}).then(function(e){i.set("location",e),i.buildContainer()}).catch(function(e){o.remove(t)})}))}.bind(this));else{var t=this.get("photo").getValue("id"),i="/photos/organize/?batch_geotag=1&ids="+t+"&from_geo_ids="+t;e.config.win.location=i}},handleError:function(e){return function(e){}},showDateEditor:function(){var t;t=new e.Views["date-modify-dialog-view"]({photoID:this.photoId,dateTaken:this.get("stats").getDateObj("dateTaken"),datePosted:this.get("stats").getDateObj("datePosted"),earliestPosted:this.get("person").getValue("dateCreated")}),new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,classList:"scrappy-dialog",width:800,showHeader:!1,showFooter:!1,showButtons:!1,showCancelButton:!1,showCancelX:!1,subview:t}).show()},handleContainerClick:function(e){e.target.ancestor(".show-extended-exif",!0)?(e.preventDefault(),e.target.hasClass("hide-moreExif")?this.hideMoreExif():this.showMoreExif()):e.target.ancestor(".edit-date-taken",!0)?(e.preventDefault(),this.showDateEditor()):e.target.ancestor(".c-charm-item-location .add-location, .c-charm-item-location .edit-location",!0)&&(e.preventDefault(),this.handleLocationClick())}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","dropdown","exif-camera-map","hermes-template-photo-charm-exif-scrappy","hermes-template-flickr-balls","url"],optional:["photo-stats-models"],langBundles:["common","photo-page-scrappy"]});YUI.add("hermes-template-sub-photo-right-stats",function(n,a){var l=n.Template.Handlebars.revive({1:function(n,a,l,e,t){var s,r,i,o=null!=a?a:{},u=l.helperMissing,p='\t<div class="right-stats-details-container">\n\t\t<div class="stat-item view-count'+(null!=(s=l.if.call(o,null!=a?a.smallText:a,{name:"if",hash:{},fn:n.program(2,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=l.if.call(o,null!=a?a.superSmallText:a,{name:"if",hash:{},fn:n.program(4,t,0),inverse:n.noop,data:t}))?s:"")+'">\n'+(null!=(s=l.if.call(o,null!=a?a.loadingView:a,{name:"if",hash:{},fn:n.program(6,t,0),inverse:n.program(8,t,0),data:t}))?s:"")+'\t\t\t<span class="stats-label">'+(null!=(s=(l.ifCond||a&&a.ifCond||u).call(o,null!=(s=null!=a?a.engagement:a)?s.viewCount:s,"===",1,{name:"ifCond",hash:{},fn:n.program(14,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=(l.ifCond||a&&a.ifCond||u).call(o,null!=(s=null!=a?a.engagement:a)?s.viewCount:s,"!==",1,{name:"ifCond",hash:{},fn:n.program(16,t,0),inverse:n.noop,data:t}))?s:"")+'</span>\n\t\t</div>\n\n\t\t<div class="stat-item fave-count'+(null!=(s=l.if.call(o,null!=a?a.smallText:a,{name:"if",hash:{},fn:n.program(2,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=l.if.call(o,null!=a?a.superSmallText:a,{name:"if",hash:{},fn:n.program(4,t,0),inverse:n.noop,data:t}))?s:"")+'">\n'+(null!=(s=l.if.call(o,null!=a?a.loadingView:a,{name:"if",hash:{},fn:n.program(18,t,0),inverse:n.program(20,t,0),data:t}))?s:"")+'\t\t\t<span class="stats-label">'+(null!=(s=(l.ifCond||a&&a.ifCond||u).call(o,null!=(s=null!=a?a.engagement:a)?s.faveCount:s,"===",1,{name:"ifCond",hash:{},fn:n.program(25,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=(l.ifCond||a&&a.ifCond||u).call(o,null!=(s=null!=a?a.engagement:a)?s.faveCount:s,"!==",1,{name:"ifCond",hash:{},fn:n.program(27,t,0),inverse:n.noop,data:t}))?s:"")+'</span>\n\t\t</div>\n\n\t\t<div class="stat-item comment-count'+(null!=(s=l.if.call(o,null!=a?a.smallText:a,{name:"if",hash:{},fn:n.program(2,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=l.if.call(o,null!=a?a.superSmallText:a,{name:"if",hash:{},fn:n.program(4,t,0),inverse:n.noop,data:t}))?s:"")+'">\n'+(null!=(s=l.if.call(o,null!=a?a.loadingView:a,{name:"if",hash:{},fn:n.program(29,t,0),inverse:n.program(31,t,0),data:t}))?s:"")+'\t\t\t<span class="stats-label">'+(null!=(s=(l.ifCond||a&&a.ifCond||u).call(o,null!=(s=null!=a?a.engagement:a)?s.commentCount:s,"===",1,{name:"ifCond",hash:{},fn:n.program(36,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=(l.ifCond||a&&a.ifCond||u).call(o,null!=(s=null!=a?a.engagement:a)?s.commentCount:s,"!==",1,{name:"ifCond",hash:{},fn:n.program(38,t,0),inverse:n.noop,data:t}))?s:"")+"</span>\n\t\t</div>\n\t</div>\n\n";return r=null!=(r=l.showMoreStatsLink||(null!=a?a.showMoreStatsLink:a))?r:u,i={name:"showMoreStatsLink",hash:{},fn:n.program(40,t,0),inverse:n.noop,data:t},s="function"==typeof r?r.call(o,i):r,l.showMoreStatsLink||(s=l.blockHelperMissing.call(a,s,i)),null!=s&&(p+=s),p},2:function(n,a,l,e,t){return" small-text"},4:function(n,a,l,e,t){return" super-small-text"},6:function(n,a,l,e,t){return'\t\t\t\t<span class="view-count-label">-</span>\n'},8:function(n,a,l,e,t){var s;return null!=(s=l.if.call(null!=a?a:{},null!=(s=null!=a?a.engagement:a)?s.viewCount:s,{name:"if",hash:{},fn:n.program(9,t,0),inverse:n.program(11,t,0),data:t}))?s:""},9:function(n,a,l,e,t){var s;return'\t\t\t\t\t<span class="view-count-label">\n\t\t\t\t\t\t'+n.escapeExpression((l.friendlyNumber||a&&a.friendlyNumber||l.helperMissing).call(null!=a?a:{},null!=(s=null!=a?a.engagement:a)?s.viewCount:s,{name:"friendlyNumber",hash:{},data:t}))+"</span>\n"},11:function(n,a,l,e,t){var s;return'\t\t\t\t\t<span class="view-count-label">\n'+(null!=(s=l.if.call(null!=a?a:{},null!=a?a.isMobileStats:a,{name:"if",hash:{},fn:n.program(12,t,0),inverse:n.noop,data:t}))?s:"")+"\t\t\t\t\t0</span>\n"},12:function(n,a,l,e,t){return'\t\t\t\t\t\t\t<svg class="icon icon-view"><use xlink:href="#icon-view"></use></svg>\n'},14:function(n,a,l,e,t){return n.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SINGULAR_VIEW"},data:t}))},16:function(n,a,l,e,t){return n.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PLURAL_VIEW"},data:t}))},18:function(n,a,l,e,t){return'\t\t\t\t<span class="fave-count-label">-</span>\n'},20:function(n,a,l,e,t){var s;return null!=(s=l.if.call(null!=a?a:{},null!=(s=null!=a?a.engagement:a)?s.faveCount:s,{name:"if",hash:{},fn:n.program(21,t,0),inverse:n.program(23,t,0),data:t}))?s:""},21:function(n,a,l,e,t){var s;return'\t\t\t\t\t<span class="fave-count-label">\n\t\t\t\t\t\t'+n.escapeExpression((l.friendlyNumber||a&&a.friendlyNumber||l.helperMissing).call(null!=a?a:{},null!=(s=null!=a?a.engagement:a)?s.faveCount:s,{name:"friendlyNumber",hash:{},data:t}))+"\n\t\t\t\t\t</span>\n"},23:function(n,a,l,e,t){return'\t\t\t\t\t<span class="fave-count-label">\n\t\t\t\t\t\t0\n\t\t\t\t\t</span>\n'},25:function(n,a,l,e,t){return n.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SINGULAR_FAVE"},data:t}))},27:function(n,a,l,e,t){return n.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PLURAL_FAVE"},data:t}))},29:function(n,a,l,e,t){return'\t\t\t\t<span class="comment-count-label">-</span>\n'},31:function(n,a,l,e,t){var s;return null!=(s=l.if.call(null!=a?a:{},null!=(s=null!=a?a.engagement:a)?s.commentCount:s,{name:"if",hash:{},fn:n.program(32,t,0),inverse:n.program(34,t,0),data:t}))?s:""},32:function(n,a,l,e,t){var s;return'\t\t\t\t\t<span class="comment-count-label">\n\t\t\t\t\t'+n.escapeExpression((l.friendlyNumber||a&&a.friendlyNumber||l.helperMissing).call(null!=a?a:{},null!=(s=null!=a?a.engagement:a)?s.commentCount:s,{name:"friendlyNumber",hash:{},data:t}))+"</span>\n"},34:function(n,a,l,e,t){return'\t\t\t\t\t<span class="comment-count-label">\n\t\t\t\t\t0</span>\n'},36:function(n,a,l,e,t){return n.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SINGULAR_COMMENT"},data:t}))},38:function(n,a,l,e,t){return n.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PLURAL_COMMENT"},data:t}))},40:function(n,a,l,e,t){return'\t\t<div class="show-more-stats">'+n.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SHOW_MORE_STATS"},data:t}))+"</div>\n"},42:function(n,a,l,e,t){var s,r,i,o=null!=a?a:{},u=l.helperMissing,p='\n\t<div class="view-count'+(null!=(s=l.if.call(o,null!=a?a.smallText:a,{name:"if",hash:{},fn:n.program(2,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=l.if.call(o,null!=a?a.superSmallText:a,{name:"if",hash:{},fn:n.program(4,t,0),inverse:n.noop,data:t}))?s:"")+'">\n'+(null!=(s=l.if.call(o,null!=a?a.loadingView:a,{name:"if",hash:{},fn:n.program(43,t,0),inverse:n.program(45,t,0),data:t}))?s:"")+'\t\t<span class="stats-label">'+(null!=(s=(l.ifCond||a&&a.ifCond||u).call(o,null!=(s=null!=a?a.engagement:a)?s.viewCount:s,"===",1,{name:"ifCond",hash:{},fn:n.program(14,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=(l.ifCond||a&&a.ifCond||u).call(o,null!=(s=null!=a?a.engagement:a)?s.viewCount:s,"!==",1,{name:"ifCond",hash:{},fn:n.program(16,t,0),inverse:n.noop,data:t}))?s:"")+'</span>\n\t</div>\n\n\t<div class="fave-count'+(null!=(s=l.if.call(o,null!=a?a.smallText:a,{name:"if",hash:{},fn:n.program(2,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=l.if.call(o,null!=a?a.superSmallText:a,{name:"if",hash:{},fn:n.program(4,t,0),inverse:n.noop,data:t}))?s:"")+'">\n'+(null!=(s=l.if.call(o,null!=a?a.loadingView:a,{name:"if",hash:{},fn:n.program(51,t,0),inverse:n.program(53,t,0),data:t}))?s:"")+'\t\t<span class="stats-label">'+(null!=(s=(l.ifCond||a&&a.ifCond||u).call(o,null!=(s=null!=a?a.engagement:a)?s.faveCount:s,"===",1,{name:"ifCond",hash:{},fn:n.program(25,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=(l.ifCond||a&&a.ifCond||u).call(o,null!=(s=null!=a?a.engagement:a)?s.faveCount:s,"!==",1,{name:"ifCond",hash:{},fn:n.program(27,t,0),inverse:n.noop,data:t}))?s:"")+'</span>\n\t</div>\n\n\t<div class="comment-count'+(null!=(s=l.if.call(o,null!=a?a.smallText:a,{name:"if",hash:{},fn:n.program(2,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=l.if.call(o,null!=a?a.superSmallText:a,{name:"if",hash:{},fn:n.program(4,t,0),inverse:n.noop,data:t}))?s:"")+'">\n'+(null!=(s=l.if.call(o,null!=a?a.loadingView:a,{name:"if",hash:{},fn:n.program(58,t,0),inverse:n.program(60,t,0),data:t}))?s:"")+'\t\t<span class="stats-label">'+(null!=(s=(l.ifCond||a&&a.ifCond||u).call(o,null!=(s=null!=a?a.engagement:a)?s.commentCount:s,"===",1,{name:"ifCond",hash:{},fn:n.program(36,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=(l.ifCond||a&&a.ifCond||u).call(o,null!=(s=null!=a?a.engagement:a)?s.commentCount:s,"!==",1,{name:"ifCond",hash:{},fn:n.program(38,t,0),inverse:n.noop,data:t}))?s:"")+"</span>\n\t</div>\n\n";return r=null!=(r=l.showMoreStatsLink||(null!=a?a.showMoreStatsLink:a))?r:u,i={name:"showMoreStatsLink",hash:{},fn:n.program(40,t,0),inverse:n.noop,data:t},s="function"==typeof r?r.call(o,i):r,l.showMoreStatsLink||(s=l.blockHelperMissing.call(a,s,i)),null!=s&&(p+=s),p},43:function(n,a,l,e,t){return'\t\t\t<span class="view-count-label">-</span>\n'},45:function(n,a,l,e,t){var s;return null!=(s=l.if.call(null!=a?a:{},null!=(s=null!=a?a.engagement:a)?s.viewCount:s,{name:"if",hash:{},fn:n.program(46,t,0),inverse:n.program(48,t,0),data:t}))?s:""},46:function(n,a,l,e,t){var s;return'\t\t\t\t<span class="view-count-label">\n\t\t\t\t\t'+n.escapeExpression((l.friendlyNumber||a&&a.friendlyNumber||l.helperMissing).call(null!=a?a:{},null!=(s=null!=a?a.engagement:a)?s.viewCount:s,{name:"friendlyNumber",hash:{},data:t}))+"</span>\n"},48:function(n,a,l,e,t){var s;return'\t\t\t\t<span class="view-count-label">\n'+(null!=(s=l.if.call(null!=a?a:{},null!=a?a.isMobileStats:a,{name:"if",hash:{},fn:n.program(49,t,0),inverse:n.noop,data:t}))?s:"")+"\t\t\t\t0</span>\n"},49:function(n,a,l,e,t){return'\t\t\t\t\t\t<svg class="icon icon-view"><use xlink:href="#icon-view"></use></svg>\n'},51:function(n,a,l,e,t){return'\t\t\t<span class="fave-count-label">-</span>\n'},53:function(n,a,l,e,t){var s;return null!=(s=l.if.call(null!=a?a:{},null!=(s=null!=a?a.engagement:a)?s.faveCount:s,{name:"if",hash:{},fn:n.program(54,t,0),inverse:n.program(56,t,0),data:t}))?s:""},54:function(n,a,l,e,t){var s;return'\t\t\t\t<span class="fave-count-label">\n\t\t\t\t\t'+n.escapeExpression((l.friendlyNumber||a&&a.friendlyNumber||l.helperMissing).call(null!=a?a:{},null!=(s=null!=a?a.engagement:a)?s.faveCount:s,{name:"friendlyNumber",hash:{},data:t}))+"\n\t\t\t\t</span>\n"},56:function(n,a,l,e,t){return'\t\t\t\t<span class="fave-count-label">\n\t\t\t\t\t0\n\t\t\t\t</span>\n'},58:function(n,a,l,e,t){return'\t\t\t<span class="comment-count-label">-</span>\n'},60:function(n,a,l,e,t){var s;return null!=(s=l.if.call(null!=a?a:{},null!=(s=null!=a?a.engagement:a)?s.commentCount:s,{name:"if",hash:{},fn:n.program(61,t,0),inverse:n.program(63,t,0),data:t}))?s:""},61:function(n,a,l,e,t){var s;return'\t\t\t\t<span class="comment-count-label">\n\t\t\t\t'+n.escapeExpression((l.friendlyNumber||a&&a.friendlyNumber||l.helperMissing).call(null!=a?a:{},null!=(s=null!=a?a.engagement:a)?s.commentCount:s,{name:"friendlyNumber",hash:{},data:t}))+"</span>\n"},63:function(n,a,l,e,t){return'\t\t\t\t<span class="comment-count-label">\n\t\t\t\t0</span>\n'},compiler:[7,">= 4.0.0"],main:function(n,a,l,e,t){var s;return"\n\n\n"+(null!=(s=(l.isFlipped||a&&a.isFlipped||l.helperMissing).call(null!=a?a:{},"enable-better-breakpoints",{name:"isFlipped",hash:{},fn:n.program(1,t,0),inverse:n.program(42,t,0),data:t}))?s:"")},useData:!0}),e={};n.Array.each([],function(a){var l=n.Template.get("hermes/"+a);l&&(e[a]=l)}),n.Template.register("hermes/sub-photo-right-stats",function(a,t){return t=t||{},t.partials=t.partials?n.merge(e,t.partials):e,l(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-stats-photo",function(t,a){var s=t.Template.Handlebars.revive({1:function(t,a,s,n,e){var l,i,o=null!=a?a:{},r=s.helperMissing,d="function",c=t.escapeExpression,v=t.lambda;return'\n\t<div class="photo-stats-basics">\n\t\t<div class="photo-stats-basics-left">\n\t\t\t<a href="'+c(typeof(i=null!=(i=s.url||(null!=a?a.url:a))?i:r)===d?i.call(o,{name:"url",hash:{},data:e}):i)+'" class="photo-thumbnail" style="background-image: url('+c(typeof(i=null!=(i=s.photoUrl||(null!=a?a.photoUrl:a))?i:r)===d?i.call(o,{name:"photoUrl",hash:{},data:e}):i)+');"></a>\n\t\t\t<div class="photo-info">\n\t\t\t\t<a href="'+c(typeof(i=null!=(i=s.url||(null!=a?a.url:a))?i:r)===d?i.call(o,{name:"url",hash:{},data:e}):i)+'" class="photo-title truncate">'+c(typeof(i=null!=(i=s.title||(null!=a?a.title:a))?i:r)===d?i.call(o,{name:"title",hash:{},data:e}):i)+'</a>\n\t\t\t\t<div class="photo-posted-date">\n'+(null!=(l=(s.friendlyDateScrappySubphoto||a&&a.friendlyDateScrappySubphoto||r).call(o,null!=a?a.datePosted:a,!1,!1,{name:"friendlyDateScrappySubphoto",hash:{},fn:t.program(2,e,0),inverse:t.noop,data:e}))?l:"")+'\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="photo-stats-basics-right">\n\t\t\t<div class="view-count"><i></i> '+c(v(null!=(l=null!=a?a.basicStats:a)?l.viewCount:l,a))+'</div>\n\t\t\t<div class="fave-count"><i></i> '+c(v(null!=(l=null!=a?a.basicStats:a)?l.faveCount:l,a))+'</div>\n\t\t\t<div class="comment-count"><i></i> '+c(v(null!=(l=null!=a?a.basicStats:a)?l.commentCount:l,a))+'</div>\n\t\t</div>\n\t</div>\n\n\t<div class="photo-stats-nav">\n\t\t<div class="nav-links">\n\t\t\t<div class="photo-stats-nav-link selected" data-link="views">'+c((s.intlMessage||a&&a.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"stats.RECENT_VIEWS"},data:e}))+'</div>\n\t\t\t<div class="photo-stats-nav-link" data-link="sources">'+c((s.intlMessage||a&&a.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"stats.SOURCES"},data:e}))+'</div>\n\t\t</div>\n\t\t<div class="photo-stats-nav-extras">\n\t\t\t<div class="date-picker">'+c(typeof(i=null!=(i=s.prettyDateString||(null!=a?a.prettyDateString:a))?i:r)===d?i.call(o,{name:"prettyDateString",hash:{},data:e}):i)+' <span></span></div>\n\t\t</div>\n\t</div>\n\n\t<div class="photo-stats-sections" data-showing="views">\n\n\t\t<div class="photo-stats-section" data-section="views">\n\t\t\t<div class="daily-views-graph">\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="photo-stats-section" data-section="sources">\n\n\t\t\t<div class="source-breakdown-left'+(null!=(l=s.unless.call(o,null!=a?a.hasReferrers:a,{name:"unless",hash:{},fn:t.program(4,e,0),inverse:t.noop,data:e}))?l:"")+'">\n\t\t\t\t<div class="no-sources">\n\t\t\t\t\t'+c((s.intlMessage||a&&a.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"stats.NO_SOURCES_TODAY"},data:e}))+'\n\t\t\t\t</div>\n\n\t\t\t\t<div class="sources-pie-chart pie-chart"></div>\n\t\t\t</div>\n\n\t\t\t<div class="source-breakdown-right'+(null!=(l=s.unless.call(o,null!=a?a.hasReferrers:a,{name:"unless",hash:{},fn:t.program(4,e,0),inverse:t.noop,data:e}))?l:"")+'">\n\t\t\t\t<div class="sources-breakdown">\n\t\t\t\t\t<div class="sources-breakdown-header">\n\t\t\t\t\t\t<div>'+c((s.intlMessage||a&&a.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"stats.SOURCES"},data:e}))+"</div>\n\t\t\t\t\t\t<div>"+c((s.intlMessage||a&&a.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"stats.VISITS"},data:e}))+'</div>\n\t\t\t\t\t\t<div>%</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="sources-breakdown-list"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t</div>\n\n\t</div>\n\n'},2:function(t,a,s,n,e){return"\t\t\t\t\t\t"+t.escapeExpression((s.intlMessage||a&&a.intlMessage||s.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlDate:null!=a?a.intlDate:a,intlName:null!=a?a.intlName:a},data:e}))+"\n"},4:function(t,a,s,n,e){return" no-results"},6:function(t,a,s,n,e){return'\n\t<div class="no-stats-available">\n\t\t'+t.escapeExpression((s.intlMessage||a&&a.intlMessage||s.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"stats.NO_RECENT_PHOTO_STATS_AVAILABLE"},data:e}))+"\n\t</div>\n\n"},compiler:[7,">= 4.0.0"],main:function(t,a,s,n,e){var l;return null!=(l=s.if.call(null!=a?a:{},null!=a?a.actuallyHasSomeStats:a,{name:"if",hash:{},fn:t.program(1,e,0),inverse:t.program(6,e,0),data:e}))?l:""},useData:!0}),n={};t.Array.each([],function(a){var s=t.Template.get("hermes/"+a);s&&(n[a]=s)}),t.Template.register("hermes/stats-photo",function(a,e){return e=e||{},e.partials=e.partials?t.merge(n,e.partials):n,s(a,e)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("timezone-helper",function(t){"use strict";t.TimezoneHelper=function(e,i,s){s?(this.tz=s,this.dst=!1):(this.tz=e.getViewer().prefs.timezonePref.offset,this.dst=e.getViewer().prefs.timezonePref.dst),this.momentObject=t.moment(i,"X"),this.momentObject.utcOffset(this.tz),this.dst&&this.momentObject.isDST()&&this.momentObject.add(1,"hour")},t.TimezoneHelper.prototype.toFormat=function(t){return this.momentObject.format(t)}},"@VERSION@",{requires:["moment"]});YUI.add("stats-helper",function(e){"use strict";var t;t=YUI.Env.isServer?require("querystring").stringify:function(e){var t,r,a,o=[];for(t in e)if(e.hasOwnProperty(t))if(Array.isArray(e[t]))for(r=0,a=e[t].length;r<a;r++)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t][r]));else o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},e.StatsHelper=function(){},e.StatsHelper.prototype.moveToFrontOfArray=function(e,t){var r=-1;return e.forEach(function(e,a){e===t&&(r=a)}),r>-1&&e.unshift(e.splice(r,1)[0]),e},e.StatsHelper.prototype.moveToEndOfArray=function(e,t){var r=-1;return e.forEach(function(e,a){e===t&&(r=a)}),r>-1&&(e.push(e[r]),e.splice(r,1)),e},e.StatsHelper.prototype.whichChild=function(e){for(var t=0;null!==(e=e.previousElementSibling);)++t;return t},e.StatsHelper.prototype.getRoundedRectanglePath=function(e,t,r,a,o,n,s){var c,i=e[0],p=e[1],u=t[0],f=t[1];return c="M"+(i+r)+","+p,c+="h"+(u-2*r),o?c+="a"+r+","+r+" 0 0 1 "+r+","+r:(c+="h"+r,c+="v"+r),c+="v"+(f-2*r),s?c+="a"+r+","+r+" 0 0 1 "+-r+","+r:(c+="v"+r,c+="h"+-r),c+="h"+(2*r-u),n?c+="a"+r+","+r+" 0 0 1 "+-r+","+-r:(c+="h"+-r,c+="v"+-r),c+="v"+(2*r-f),a?c+="a"+r+","+r+" 0 0 1 "+r+","+-r:(c+="v"+-r,c+="h"+r),c+="z"},e.StatsHelper.prototype.getIdFromParams=function(e){var r=t(e);return""===r&&(r=1),r},e.StatsHelper.prototype.convertStorageTotalToRealNumber=function(e){var t=e;return-1===e&&(t=-1),t},e.StatsHelper.prototype.convertStorageAmountToRealNumber=function(e){var t,r,a;return e=parseInt(e,10)||1,t=Math.ceil(Math.log(e)/Math.LN10),r=Math.floor(t/3),a=e/Math.pow(10,3*r),a=Math.floor(100*a)/100},e.StatsHelper.prototype.convertNaturalLanguageDateToRealDateTimestamp=function(t,r){var a,o="";switch(a=e.moment(),r){case"today":o=a;break;case"yesterday":o=a.subtract(1,"days");break;case"thisweek":case"week":o=a.startOf("week");break;case"lastweek":o=a.subtract(1,"weeks").startOf("week");break;case"twoweeksago":case"theweekbeforethat":o=a.subtract(2,"weeks").startOf("week");break;case"threeweeksago":case"theweekbeforetheweekbeforethat":o=a.subtract(3,"weeks").startOf("week")}return""!==o&&(o=new e.TimezoneHelper(t,o.format("X"),"+00:00").toFormat("YYYY-MM-DD")),o}},"@VERSION@",{affinity:"",requires:["flickr-promise","event-custom","moment","timezone-helper"],optional:[]});YUI.add("flickr-stats-photo-daily-views-fetcher",function(e,s){"use strict";e.namespace("ModelFetchers")["flickr-stats-photo-daily-views"]={run:function(t,a){var o=this;return new e.FlickrPromise({apiResponse:a.callAPI("flickr.stats.photo.getGraphData",this._processParams(t)),modelRegistry:a.getModelRegistry("stats-photo-daily-views-models")}).then(function(e){return o._processResponse(e,t)},e.FetcherErrorLogger(s))},_processResponse:function(s,t){var a,o,i,r,n,d,l=s.apiResponse.stats.graphdata,c=s.modelRegistry,p={},m={};return d={views:0,favs:0,comments:0},a={id:t.id},l&&(p=l,Object.keys(l).forEach(function(e,s){p[e].burp||p[e].nodot?delete p[e]:(i?(i>e&&(i=e),n<e&&(n=e)):(i=e,n=e),p[e].views||(p[e].views=0),p[e].comments||(p[e].comments=0),p[e].favs||(p[e].favs=0),p[e].views=parseInt(p[e].views,10),p[e].favs=parseInt(p[e].favs,10),p[e].comments=parseInt(p[e].comments,10),d.views+=p[e].views,d.favs+=p[e].favs,d.comments+=p[e].comments)})),a.days=p,a.oldestDate=i,a.newestDate=n,a.totals=d,c.exists(a.id)?(m=c.getValue("days"),a.days=e.merge(a.days,m),o=c.getValue("oldestDate"),i>o&&(a.oldestDate=o),r=c.getValue("newestDate"),n>r&&(a.newestDate=r),a.totals+=e.merge(a.totals,c.getValue("totals")),c.setValues(a.id,a)):c.add(a),a},_processParams:function(e){return{id:e.id,photo_id:e.photoId}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["stats-photo-daily-views-models"]});YUI.add("stats-photo-daily-views-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-stats-photo-daily-views"].run(e,this.appContext)}},attributes:{days:{},oldestDate:{},newestDate:{},totals:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-stats-photo-daily-views-fetcher"]});